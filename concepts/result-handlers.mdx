---
title: "Result Handlers"
description: "Handle step outcomes with conditional logic using step.on() methods"
---

# Result Handlers

Result handlers define how agents respond to step outcomes, enabling sophisticated conditional logic and workflow control. Use `step.on()` methods for clean, readable result handling.

## What are Result Handlers?

Result handlers allow you to:

- **React to step outcomes** (success, failure, specific conditions)
- **Implement conditional logic** based on step results
- **Chain actions** based on different scenarios
- **Handle errors gracefully** with fallback strategies
- **Control workflow flow** dynamically

<CardGroup cols={2}>
  <Card title="Direct Handlers" icon="link">
    Use step.on() for direct action chaining
  </Card>
  <Card title="Conditional Logic" icon="code-branch">
    Complex conditions with & (and), | (or), ~ (not) operators
  </Card>
  <Card title="Error Recovery" icon="refresh">
    Implement sophisticated error handling and recovery
  </Card>
  <Card title="Multiple Actions" icon="layers">
    Chain multiple actions in a single handler
  </Card>
</CardGroup>

## Handler Methods

### Result Handlers with step.on()

Handle step outcomes with conditional logic:

```python
from erdo import Agent
from erdo.actions import llm, memory, utils
from erdo.conditions import IsSuccess, IsError, GreaterThan, LessThan, TextContains

agent = Agent(name="analysis_agent")

analysis_step = agent.step(
    llm.message(
        model="claude-sonnet-4",
        query="Analyze this data: {{input_data}}",
        response_format={
            "Type": "json_schema",
            "Schema": {
                "type": "object",
                "properties": {
                    "confidence": {"type": "number"},
                    "insights": {"type": "array"},
                    "risk_level": {"type": "string"}
                }
            }
        }
    )
)

# Store high-confidence analysis results
analysis_step.on(
    IsSuccess() & GreaterThan("confidence", "0.8"),
    memory.store(memory={
        "content": "{{analysis_step.output.insights}}",
        "description": "High-confidence analysis results",
        "type": "analysis_result",
        "tags": ["analysis", "high-confidence"],
        "extra": {"confidence": "{{analysis_step.output.confidence}}"}
    })
)

# Request review for moderate confidence results
analysis_step.on(
    IsSuccess() & LessThan("confidence", "0.8") & GreaterThan("confidence", "0.5"),
    utils.send_status(
        status="review_needed",
        message="Analysis completed with moderate confidence. Human review recommended.",
        data="{{analysis_step.output}}"
    )
)

# Flag low confidence results
analysis_step.on(
    IsSuccess() & LessThan("confidence", "0.5"),
    utils.send_status(
        status="low_confidence",
        message="Analysis completed but confidence is very low. Results may be unreliable.",
        data="{{analysis_step.output}}"
    )
)

# Handle analysis failures
analysis_step.on(
    IsError(),
    utils.send_status(
        status="failed",
        message="Analysis failed: {{analysis_step.error.message}}",
        error="{{analysis_step.error.details}}"
    )
)
```

### Multiple Action Handlers

Chain multiple actions in a single handler:

```python
# Single action handler
analysis_step.on(
    IsSuccess() & GreaterThan("confidence", "0.9"),
    utils.send_status(status="excellent", message="Excellent analysis results")
)

# Multiple action handler
analysis_step.on(
    IsSuccess() & GreaterThan("confidence", "0.9"),
    utils.send_status(status="excellent", message="Excellent analysis results"),
    memory.store(memory={
        "content": "{{analysis_step.output.insights}}",
        "type": "excellent_analysis"
    }),
    utils.echo(message="Analysis stored successfully")
)

# Handle critical risk levels
analysis_step.on(
    IsSuccess() & TextContains("risk_level", "critical"),
    utils.send_status(
        status="critical_alert",
        message="CRITICAL RISK DETECTED - Immediate attention required",
        priority="urgent"
    )
)

# Simple error handling
analysis_step.on(
    IsError(),
    utils.send_status(status="failed", message="Analysis failed, retrying...")
)
```

## Conditional Logic

### Basic Conditions

```python
from erdo.conditions import (
    IsSuccess, IsError, GreaterThan, LessThan,
    TextContains, TextEquals, Not
)

# Success conditions
step.on(
    IsSuccess(),
    memory.store(memory={"content": "{{step.output.data}}"})
)

# Error conditions
step.on(
    IsError(),
    utils.send_status(status="failed", message="{{step.error.message}}")
)

# Numeric comparisons
step.on(
    IsSuccess() & GreaterThan("score", "0.8"),
    utils.send_status(status="high_score", message="Excellent results!")
)

step.on(
    IsSuccess() & LessThan("score", "0.3"),
    utils.send_status(status="low_score", message="Results need improvement")
)

# Text conditions
step.on(
    IsSuccess() & TextContains("category", "urgent"),
    utils.send_status(status="urgent", priority="high")
)

step.on(
    IsSuccess() & TextEquals("status", "completed"),
    memory.store(memory={"content": "Task completed successfully"})
)
```

### Complex Conditions

Combine conditions with logical operators:

```python
# AND operator (&)
step.on(
    IsSuccess() & GreaterThan("confidence", "0.8") & TextContains("category", "important"),
    memory.store(memory={
        "content": "{{step.output.analysis}}",
        "type": "high_priority_analysis"
    })
)

# OR operator (|)
step.on(
    IsSuccess() & (TextContains("risk_level", "high") | TextContains("risk_level", "critical")),
    utils.send_status(
        status="high_risk_alert",
        message="High or critical risk detected",
        priority="urgent"
    )
)

# NOT operator (~)
step.on(
    IsSuccess() & ~TextContains("status", "completed"),
    utils.send_status(
        status="incomplete",
        message="Task not yet completed"
    )
)

# Complex nested conditions
step.on(
    IsSuccess() & (
        (GreaterThan("confidence", "0.9") & TextContains("category", "finance")) |
        (GreaterThan("confidence", "0.8") & TextContains("category", "critical"))
    ),
    memory.store(memory={
        "content": "{{step.output.data}}",
        "type": "priority_result"
    })
)
```

## Error Handling and Recovery

### Retry Logic

```python
from erdo.conditions import IsError, LessThan, GreaterThan

process_step = agent.step(
    codeexec.execute(
        code_files=[{
            "filename": "main_process.py",
            "content": "main_processing_logic({{input_data}})"
        }]
    )
)

# Retry processing with fallback method
process_step.on(
    IsError() & LessThan("retry_count", "3"),
    codeexec.execute(
        code_files=[{
            "filename": "fallback_process.py",
            "content": "fallback_processing_logic({{input_data}})"
        }]
    )
)

# Escalate after max retries
process_step.on(
    IsError() & GreaterThan("retry_count", "2"),
    utils.send_status(
        status="escalated",
        message="Processing failed after 3 attempts: {{process_step.error.message}}",
        priority="high"
    )
)
```

### Graceful Degradation

```python
# Primary analysis step
primary_analysis = agent.step(
    llm.message(model="claude-sonnet-4", query="{{complex_query}}")
)

# Use simpler model as fallback
primary_analysis.on(
    IsError(),
    llm.message(
        model="gpt-4",
        query="{{simplified_query}}",
        system_prompt="Provide a basic analysis of the given data"
    )
)

# Secondary analysis if primary fails
secondary_analysis = agent.step(
    llm.message(model="gpt-4", query="{{fallback_query}}")
)

secondary_analysis.on(
    IsError(),
    utils.send_status(
        status="analysis_failed",
        message="Both primary and secondary analysis failed",
        priority="high"
    )
)
```

### Specialized Error Handling

```python
data_processing = agent.step(
    codeexec.execute(
        code_files=[{
            "filename": "data_processor.py",
            "content": "process_large_dataset({{dataset}})"
        }]
    )
)

# Handle memory errors
data_processing.on(
    IsError() & TextContains("error_type", "memory"),
    codeexec.execute(
        code_files=[{
            "filename": "chunked_processor.py",
            "content": "process_dataset_in_chunks({{dataset}})"
        }]
    )
)

# Handle format errors
data_processing.on(
    IsError() & TextContains("error_type", "format"),
    llm.message(
        model="claude-sonnet-4",
        query="Convert this data to proper format: {{dataset}}",
        system_prompt="You are a data format converter"
    )
)
```

## Advanced Patterns

### Conditional Workflows

```python
# Initial complexity assessment
initial_analysis = agent.step(
    llm.message(
        model="claude-sonnet-4",
        query="Assess complexity and confidence: {{input_data}}"
    )
)

# Route to detailed analysis for complex cases
initial_analysis.on(
    IsSuccess() & GreaterThan("complexity", "0.8"),
    codeexec.execute(
        code_files=[{
            "filename": "detailed_analysis.py",
            "content": "perform_detailed_analysis({{input_data}})"
        }]
    )
)

# Use simple analysis for straightforward cases
initial_analysis.on(
    IsSuccess() & LessThan("complexity", "0.3"),
    llm.message(model="gpt-4", query="Simple analysis: {{input_data}}")
)

# Use high-confidence results immediately
initial_analysis.on(
    IsSuccess() & GreaterThan("confidence", "0.9"),
    memory.store(memory={
        "content": "{{initial_analysis.output.insights}}",
        "type": "quick_analysis",
        "tags": ["fast", "high-confidence"]
    })
)
```

### Risk-Based Processing

```python
risk_assessment = agent.step(
    llm.message(
        model="claude-sonnet-4",
        query="Assess risk level: {{transaction_data}}"
    )
)

# Auto-approve low-risk transactions
risk_assessment.on(
    IsSuccess() & LessThan("risk_score", "0.3"),
    utils.send_status(
        status="auto_approved",
        message="Transaction auto-approved (low risk)",
        data="{{risk_assessment.output}}"
    )
)

# Flag medium-risk for review
risk_assessment.on(
    IsSuccess() & GreaterThan("risk_score", "0.3") & LessThan("risk_score", "0.7"),
    utils.send_status(
        status="review_required",
        message="Transaction flagged for manual review",
        priority="medium"
    )
)

# Block high-risk transactions
risk_assessment.on(
    IsSuccess() & GreaterThan("risk_score", "0.7"),
    utils.send_status(
        status="blocked",
        message="Transaction blocked due to high risk",
        priority="high"
    )
)
```

### Content-Type Routing

```python
content_analysis = agent.step(
    llm.message(
        model="claude-sonnet-4",
        query="Analyze content type and quality: {{content}}"
    )
)

# Route technical content to specialized processor
content_analysis.on(
    IsSuccess() & TextEquals("content_type", "technical"),
    llm.message(
        model="claude-sonnet-4",
        query="Technical analysis: {{content}}",
        system_prompt="You are a technical documentation expert"
    )
)

# Route creative content to different processor
content_analysis.on(
    IsSuccess() & TextEquals("content_type", "creative"),
    llm.message(
        model="claude-sonnet-4",
        query="Creative analysis: {{content}}",
        system_prompt="You are a creative writing expert"
    )
)

# Route legal content to compliance checker
content_analysis.on(
    IsSuccess() & TextEquals("content_type", "legal"),
    llm.message(
        model="claude-sonnet-4",
        query="Legal compliance check: {{content}}",
        system_prompt="You are a legal compliance expert"
    )
)

# Flag low-quality content
content_analysis.on(
    IsSuccess() & LessThan("quality_score", "0.4"),
    utils.send_status(
        status="quality_issue",
        message="Content quality below threshold",
        data="{{content_analysis.output}}"
    )
)
```

## Best Practices

### Handler Organization

```python
# Group related handlers logically
analysis_step.on(IsSuccess() & GreaterThan("confidence", "0.8"), high_confidence_action)
analysis_step.on(IsSuccess() & LessThan("confidence", "0.5"), low_confidence_action)
analysis_step.on(IsError(), error_handling_action)

# Use descriptive condition combinations
step.on(IsSuccess() & GreaterThan("score", "0.9"), excellent_result_action)
step.on(IsSuccess() & GreaterThan("score", "0.7") & LessThan("score", "0.9"), good_result_action)
step.on(IsSuccess() & LessThan("score", "0.7"), needs_improvement_action)
```

### Error Handling

```python
# Always include error handlers
step.on(IsError(), fallback_action)

# Use specific error conditions when possible
step.on(IsError() & TextContains("error", "timeout"), retry_action)
step.on(IsError() & TextContains("error", "permission"), escalate_action)
```

### Condition Reusability

```python
# Define reusable conditions
high_confidence = IsSuccess() & GreaterThan("confidence", "0.8")
critical_priority = TextContains("priority", "critical") | TextContains("priority", "urgent")
complex_condition = high_confidence & critical_priority

# Use in handlers
step.on(complex_condition, priority_processing_action)
```

### Validation Patterns

```python
validation_step = agent.step(
    llm.message(query="Validate: {{data}}")
)

validation_step.on(
    IsSuccess(),
    memory.store(memory={
        "content": "{{validation_step.output.result}}",
        "type": "validated_data"
    })
)

validation_step.on(
    IsError(),
    utils.send_status(
        status="validation_failed",
        message="Data validation failed"
    )
)
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Actions" icon="bolt" href="/concepts/actions">
    Explore the available action types for result handlers
  </Card>
  <Card title="Conditions" icon="filter" href="/concepts/conditions">
    Master the condition system for complex logic
  </Card>
  <Card title="Examples" icon="lightbulb" href="/examples/business-automation">
    See result handlers in complete workflows
  </Card>
  <Card title="Best Practices" icon="star" href="/concepts/agents">
    Learn agent design patterns and best practices
  </Card>
</CardGroup>
